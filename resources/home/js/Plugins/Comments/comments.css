@import "tailwindcss";
@plugin "@tailwindcss/typography";
@plugin "daisyui";

.comment-editor {
  transition: all 0.2s;

  &:focus-within {
    border-color: #8d8d8d;
    @apply shadow shadow-lg shadow-amber-800;
  }

  &.is-active {
    .toolbar {
      @apply flex;
    }

    .editor {
      .tiptap {
        p:first-child {
          @apply mt-3;
        }
      }
    }
  }

  &.has-error {
    @apply border-error shadow-error;
  }

  .toolbar {
    .format {
      button {
        @apply mr-2 flex cursor-pointer items-center justify-center rounded-sm border-0 bg-transparent;
        outline: none;
        transition: all 0.2s;
        width: 28px;
        height: 28px;

        &:hover {
          @apply shadow-info bg-gray-200;
        }

        &.is-active {
          @apply bg-accent shadow-primary-content;

          svg {
            fill: #fff;
          }
        }

        &:last-child {
          margin-right: 0;
        }

        svg {
          width: 20px;
          height: 20px;
          flex-shrink: 0;
          flex-grow: 0;
        }
      }
    }

    .actions {
      button {
        transition: all 0.2s;
      }
    }
  }
}

.comment {
  --avatar-size: 28px;
  --vertical-border-color: rgb(133 133 133);
  --vertical-border-active-color: rgb(206, 206, 206);
  padding-top: 1rem;

  &.hasChildren {
    position: relative;

    > .content {
      position: relative;

      &::before {
        content: "";
        position: absolute;
        left: calc(var(--avatar-size) / 2);
        top: 1em;
        width: 1px;
        height: calc(100% - 1em);
        border-left: 1px solid var(--vertical-border-color);
        transition: all 0.2s;
      }
    }

    .children {
      background-color: inherit;
      padding-left: 2em;

      .vertical-line-box {
        position: absolute;
        top: 0;
        left: 0;
        width: var(--avatar-size);
        height: calc(100% - var(--avatar-size));
        display: flex;
        justify-content: center;
        z-index: 2;
      }

      .comment {
        position: relative;

        &::before {
          content: "";
          position: absolute;
          left: calc(calc(var(--avatar-size) / 2) * -1);
          top: 0;
          width: 1px;
          height: 100%;
          border-left: 1px solid var(--vertical-border-color);
          transition: all 0.2s;
        }

        &:last-child::before {
          content: none;
        }

        .info {
          position: relative;

          &::before {
            content: "";
            position: absolute;
            top: calc(calc(var(--avatar-size) / 3) * -1);
            left: calc(calc(var(--avatar-size) / 2) * -1);
            width: calc(calc(var(--avatar-size) / 2) - 5px);
            height: calc(var(--avatar-size) * 0.75);
            border-left: 1px solid var(--vertical-border-color);
            border-bottom: 1px solid var(--vertical-border-color);
            border-bottom-left-radius: 3em;
            transition: all 0.2s;
          }
        }

        &:last-child .info::before {
          top: calc(calc(var(--avatar-size) / 2) * -1);
        }
      }

      .show-more {
        @apply flex items-baseline;
        transform: translateX(calc(var(--avatar-size) * -1));

        .line {
          height: 2em;
          width: calc(var(--avatar-size) + 1em);
          position: relative;
          padding-bottom: 0.5em;
          transition: all 0.2s;

          &::before {
            content: "";
            position: absolute;
            left: calc(var(--avatar-size) / 2);
            top: 0;
            width: calc(var(--avatar-size) / 2);
            height: 1.5em;
            border-left: 1px solid var(--vertical-border-color);
            border-bottom: 1px solid var(--vertical-border-color);
            border-bottom-left-radius: 3em;
          }

          &::after {
            content: "";
            position: absolute;
            left: var(--avatar-size);
            top: 0;
            width: 0.5em;
            height: 1.5em;
            border-bottom: 1px solid var(--vertical-border-color);
          }
        }

        .text {
          @apply text-slate-300;
          cursor: pointer;
          font-size: 13px;
          transition: all 0.2s;
          font-weight: 600;
          display: flex;
          flex-direction: row;
          align-items: center;

          .icon {
            line-height: 1;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid #888;
            margin-right: 5px;

            svg {
              width: 14px;
              height: 14px;

              path {
                fill: #fff;
              }
            }
          }

          &:hover {
            color: #333;
          }
        }
      }
    }

    &.active {
      > .content::before {
        border-left-color: var(--vertical-border-active-color);
      }

      > .children {
        > .comment {
          &::before {
            border-left-color: var(--vertical-border-active-color);
          }

          > .info::before {
            border-left-color: var(--vertical-border-active-color);
            border-bottom-color: var(--vertical-border-active-color);
          }
        }

        > .show-more {
          .line {
            &::before {
              border-left-color: var(--vertical-border-active-color);
              border-bottom-color: var(--vertical-border-active-color);
            }

            &::after {
              border-bottom-color: var(--vertical-border-active-color);
            }
          }
        }
      }
    }
  }

  .info {
    display: flex;
    align-items: center;
    justify-content: flex-start;

    .avatar {
      @apply mr-4 flex items-center justify-center overflow-hidden bg-slate-600 text-slate-200;
      width: var(--avatar-size);
      height: var(--avatar-size);
      background-size: cover;
      background-repeat: no-repeat;
      border-radius: 3px;
      text-transform: uppercase;
    }

    .name {
      @apply mr-4 text-base font-bold;
    }

    .time {
      @apply relative px-5 font-normal opacity-65;

      &::before,
      &::after {
        content: "";
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: currentColor;
      }

      &::before {
        left: 3px;
      }

      &::after {
        right: 3px;
      }
    }
  }

  .content {
    padding-left: 2rem;
    position: relative;
    padding-top: 1em;
  }
}

.load-more {
  margin-top: 1.5rem;
  display: flex;
  flex-flow: row nowrap;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  transition: all 0.2s;
  padding: 0.5rem;
  border-radius: 5px;

  &:hover {
    background-color: rgba(87, 111, 118, 0.27);
  }

  .icon {
    margin-right: 0.5rem;
  }

  span {
    font-size: 13px;
    font-weight: 600;
    color: #222;
  }
}
